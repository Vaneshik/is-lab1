name: ğŸš€ CI - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‡Ñ‚Ğ¾ Ğ²ÑÑ‘ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ÑÑ

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  backend-build:
    name: ğŸ”¨ Backend Build
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: â˜• Setup Java 17
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '17'
        cache: 'maven'
    
    - name: ğŸ”§ Build with Maven
      run: mvn clean compile -q
    
    - name: ğŸ“¦ Package WAR
      run: mvn package -DskipTests -q
    
    - name: âœ… Check WAR exists
      run: |
        if [ -f target/person-management-system.war ]; then
          echo "âœ… WAR Ñ„Ğ°Ğ¹Ğ» ÑĞ¾Ğ±Ñ€Ğ°Ğ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!"
          ls -lh target/person-management-system.war
        else
          echo "âŒ WAR Ñ„Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½!"
          exit 1
        fi

  frontend-build:
    name: ğŸ¨ Frontend Build
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: ğŸ“¦ Install dependencies
      run: |
        cd frontend
        npm install
    
    - name: ğŸ”¨ Build React app
      run: |
        cd frontend
        npm run build
    
    - name: âœ… Check build output
      run: |
        if [ -d frontend/build ]; then
          echo "âœ… Frontend ÑĞ¾Ğ±Ñ€Ğ°Ğ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!"
          ls -lh frontend/build
        else
          echo "âŒ Build Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°!"
          exit 1
        fi

  docker-check:
    name: ğŸ³ Docker Build Check
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ğŸ³ Build Docker image
      run: |
        cd frontend
        docker build -t test-frontend:latest .
    
    - name: âœ… Docker build success
      run: echo "âœ… Docker Ğ¾Ğ±Ñ€Ğ°Ğ· ÑĞ¾Ğ±Ñ€Ğ°Ğ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!"

  all-checks-passed:
    name: âœ¨ Ğ’ÑĞµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ñ‹
    runs-on: ubuntu-latest
    needs: [backend-build, frontend-build, docker-check]
    
    steps:
    - name: ğŸ‰ Success
      run: |
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘  ğŸ‰ Ğ’Ğ¡Ğ• ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ˜ ĞŸĞ ĞĞ¨Ğ›Ğ˜ Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ! ğŸ‰  â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "âœ… Backend ÑĞ¾Ğ±Ñ€Ğ°Ğ»ÑÑ"
        echo "âœ… Frontend ÑĞ¾Ğ±Ñ€Ğ°Ğ»ÑÑ"  
        echo "âœ… Docker Ğ¾Ğ±Ñ€Ğ°Ğ· Ğ³Ğ¾Ñ‚Ğ¾Ğ²"
        echo ""
        echo "Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ Ğº Ğ´ĞµĞ¿Ğ»Ğ¾Ñ! ğŸš€"

